# トラブルシューティングガイド

このガイドでは、一般的な問題の解決策とデバッグのヒントを提供します。

## 認証

- **エラー: `Failed to login. Message: Request contains an invalid argument` (ログインに失敗しました。メッセージ: リクエストに無効な引数が含まれています)**

  - Google Workspace アカウントを持つユーザー、または Gmail アカウントに関連付けられた Google Cloud アカウントを持つユーザーは、Google Code Assist プランの無料ティアを有効にできない場合があります。
  - Google Cloud アカウントの場合、`GOOGLE_CLOUD_PROJECT` をプロジェクト ID に設定することでこれを回避できます。
  - [AI Studio](http://aistudio.google.com/app/apikey) から API キーを取得することもできます。これには別の無料ティアが含まれています。

## よくある質問 (FAQ)

- **Q: Gemini CLI を最新バージョンに更新するにはどうすればよいですか？**

  - A: npm を介してグローバルにインストールした場合、`npm install -g @google/gemini-cli@latest` コマンドを使用して Gemini CLI を更新します。ソースから実行した場合、リポジトリから最新の変更を取得し、`npm run build` を使用して再ビルドします。

- **Q: Gemini CLI 設定ファイルはどこに保存されますか？**

  - A: CLI 設定は2つの `settings.json` ファイルに保存されます。1つはホームディレクトリに、もう1つはプロジェクトのルートディレクトリにあります。どちらの場所でも、`settings.json` は `.gemini/` フォルダにあります。詳細については、[CLI 設定](./cli/configuration.md)を参照してください。

- **Q: 統計出力にキャッシュされたトークン数が表示されないのはなぜですか？**

  - A: キャッシュされたトークン情報は、キャッシュされたトークンが使用されている場合にのみ表示されます。この機能は、API キーユーザー (Gemini API キーまたは Vertex AI) は利用できますが、現時点では OAuth ユーザー (Google 個人/エンタープライズアカウント) は利用できません。Code Assist API はキャッシュされたコンテンツ作成をサポートしていないためです。`/stats` コマンドで合計トークン使用量を確認することはできます。

## 一般的なエラーメッセージと解決策

- **エラー: MCP サーバーの起動時に `EADDRINUSE` (アドレスは既に使用されています)。**

  - **原因:** MCP サーバーがバインドしようとしているポートを別のプロセスが既に使用しています。
  - **解決策:**
    ポートを使用している他のプロセスを停止するか、MCP サーバーが別のポートを使用するように設定します。

- **エラー: コマンドが見つかりません (Gemini CLI を実行しようとしたとき)。**

  - **原因:** Gemini CLI が正しくインストールされていないか、システムの PATH に含まれていません。
  - **解決策:**
    1. Gemini CLI のインストールが成功したことを確認します。
    2. グローバルにインストールした場合、npm グローバルバイナリディレクトリが PATH に含まれていることを確認します。
    3. ソースから実行している場合、それを呼び出すために正しいコマンドを使用していることを確認します (例: `node packages/cli/dist/index.js ...`)。

- **エラー: `MODULE_NOT_FOUND` またはインポートエラー。**

  - **原因:** 依存関係が正しくインストールされていないか、プロジェクトがビルドされていません。
  - **解決策:**
    1. `npm install` を実行して、すべての依存関係が存在することを確認します。
    2. `npm run build` を実行してプロジェクトをコンパイルします。

- **エラー: "Operation not permitted" (操作は許可されていません)、"Permission denied" (アクセス許可が拒否されました)、または同様のエラー。**

  - **原因:** サンドボックス化が有効になっている場合、アプリケーションはプロジェクトディレクトリ外への書き込みやシステムの一時ディレクトリへの書き込みなど、サンドボックスによって制限されている操作を実行しようとしている可能性があります。
  - **解決策:** サンドボックス設定のカスタマイズ方法など、詳細については [サンドボックス化](./cli/configuration.md#sandboxing) を参照してください。

## デバッグのヒント

- **CLI デバッグ:**

  - 詳細な出力については、CLI コマンドで `--verbose` フラグ (利用可能な場合) を使用します。
  - CLI ログを確認します。多くの場合、ユーザー固有の設定またはキャッシュディレクトリにあります。

- **コアデバッグ:**

  - エラーメッセージまたはスタックトレースについては、サーバーコンソールの出力を確認します。
  - 設定可能な場合は、ログの詳細度を上げます。
  - サーバー側のコードをステップ実行する必要がある場合は、Node.js デバッグツール (例: `node --inspect`) を使用します。

- **ツールの問題:**

  - 特定のツールが失敗している場合は、ツールが実行するコマンドまたは操作の最も単純なバージョンを実行して問題を切り分けます。
  - `run_shell_command` の場合、最初にコマンドがシェルで直接動作することを確認します。
  - ファイルシステムツールの場合、パスとアクセス許可を再確認します。

- **事前チェック:**
  - コードをコミットする前に、必ず `npm run preflight` を実行してください。これにより、フォーマット、リンティング、型エラーに関連する多くの一般的な問題を検出できます。

ここに記載されていない問題が発生した場合は、GitHub のプロジェクトの課題トラッカーを検索するか、詳細情報を添えて新しい課題を報告することを検討してください。
